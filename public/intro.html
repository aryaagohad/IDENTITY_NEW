<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ID / ENTITY — INTRO</title>

  <!-- Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #060708;
      --panel: #e7eef8;
      --muted: #99a0ad;
      --accent: #ff5c57;
      font-family: "Inter", system-ui, sans-serif;
    }
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; height:100%; background:var(--bg); color:var(--panel); -webkit-font-smoothing:antialiased; }

    .device { width:100%; max-width:980px; padding:24px; margin:20px auto; }

    .topbar { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
    .leds { display:flex; gap:6px; }
    .led { width:10px; height:10px; border-radius:50%; box-shadow: inset 0 1px 0 rgba(0,0,0,0.3); }
    .led.red { background:#ff5c57; }
    .led.yellow { background:#ffd166; }
    .led.green { background:#6bffb8; }
    .brand { font-size:12px; letter-spacing:0.12em; font-weight:700; }

    .screen {
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:18px;
      border:1px solid rgba(255,255,255,0.02);
    }

    .intro-card {
      display:grid;
      grid-template-columns:1fr 220px;
      gap:18px;
      padding:18px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.02);
      background:rgba(255,255,255,0.01);
    }
    @media(max-width:820px){ .intro-card{ grid-template-columns:1fr; } }

    .intro-left { display:flex; flex-direction:column; gap:12px; }

    #textBox {
      font-family:Inter, system-ui;
      background:rgba(0,0,0,0.12);
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.02);
      padding:14px;
      line-height:1.6;
      font-size:15px;
      color:var(--panel);
      white-space:pre-wrap;
      overflow:auto;
      min-height:220px;
      max-height:420px;
      position:relative; /* needed for absolute cursor */
    }

    /* STABLE NON-FLICKERING CURSOR */
    #cursor {
      position:absolute;
      width:10px;
      height:20px;
      background:var(--panel);
      animation: blink 1s steps(2, start) infinite;
      opacity:0.9;
    }
    @keyframes blink { 50% { opacity:0; } }

    .intro-right { display:flex; flex-direction:column; gap:12px; align-items:center; }

    .qrBox {
      width:100%;
      max-width:220px;
      border-radius:8px;
      padding:10px;
      border:1px solid rgba(255,255,255,0.02);
      display:flex;
      justify-content:center;
      align-items:center;
      background:rgba(255,255,255,0.01);
    }
    .qrBox img { width:180px; height:180px; object-fit:contain; }

    .controls-row{ display:flex; gap:8px; justify-content:center; width:100%; }

    .btn {
      border:1px solid rgba(255,255,255,0.04);
      background:transparent;
      color:var(--panel);
      padding:10px 14px;
      border-radius:8px;
      font-family: ui-monospace, Menlo, monospace;
      font-size:12px;
      letter-spacing:0.08em;
      text-transform:uppercase;
      text-decoration:none;
      cursor:pointer;
    }
    .btn-primary { background:var(--accent); border:none; color:white; }

    .meta { margin-top:12px; font-size:12px; color:var(--muted); }
  </style>
</head>

<body>

<div class="device">
  <div class="topbar">
    <div class="leds">
      <div class="led red"></div>
      <div class="led yellow"></div>
      <div class="led green"></div>
    </div>
    <div class="brand">IDENTITY • INTRO</div>
    <div style="width:28px"></div>
  </div>

  <div class="screen">
    <div class="intro-card">

      <!-- LEFT -->
      <div class="intro-left">
        <div style="display:flex; justify-content:space-between;">
          <div style="font-weight:700; letter-spacing:0.08em; font-size:13px;">ID / ENTITY — INTRODUCTION</div>
          <div style="font-family:ui-monospace; font-size:12px; color:var(--muted); letter-spacing:0.08em;">SESSION • EXHIBIT 01</div>
        </div>

        <div id="textBox"></div>
        <div class="meta">When you're ready, scan the QR to begin the live experience on your phone.</div>
      </div>

      <!-- RIGHT -->
      <div class="intro-right">
        <div class="qrBox">
          <img src="/QR.jpeg" alt="QR">
        </div>

        <div class="controls-row">
          <button id="replay" class="btn">Replay</button>
          <a href="hostMode.html" target="_blank" class="btn btn-primary">Host Mode</a>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
/* --------------------------------------
   Live Typing + Stable Cursor (no flicker)
-------------------------------------- */

const text = `When you introduce yourself, what is something that you simply cannot miss to mention?

Your name.

It is the single most important marker of your identity — yet it is given to you, never chosen by you.

In today's experience, we will begin with introducing ourselves:
to each other, and to the system.

We start with the simple act of saying our names out loud —
and through this, explore the construct of identity.

Interacting with the system to realise that
identity and identification
are two very separate phenomena.`;

const box = document.getElementById('textBox');
const replayBtn = document.getElementById('replay');

let idx = 0;
let timer;

// Create & append cursor
const cursor = document.createElement('div');
cursor.id = 'cursor';
box.appendChild(cursor);

// Position cursor at end of content
function updateCursor() {
  const range = document.createRange();
  const sel = window.getSelection();

  // If no text, place cursor at top-left
  if (!box.firstChild || box.childNodes.length === 1) {
    cursor.style.left = "8px";
    cursor.style.top = "8px";
    return;
  }

  let last = box.lastChild;

  // Skip cursor node
  if (last === cursor) last = box.childNodes[box.childNodes.length - 2];

  try {
    range.setStart(last, last.length || last.childNodes?.length || 0);
    range.setEnd(last, last.length || last.childNodes?.length || 0);
  } catch (e) {
    try {
      range.selectNodeContents(box);
      range.collapse(false);
    } catch (e2) {}
  }

  const rect = range.getBoundingClientRect();
  const parentRect = box.getBoundingClientRect();

  cursor.style.left = (rect.left - parentRect.left) + "px";
  cursor.style.top  = (rect.top - parentRect.top) + "px";
}

// Typing logic
function typeStep() {
  if (idx >= text.length) return;

  const ch = text.charAt(idx);

  if (ch === "\n") {
    box.appendChild(document.createElement('br'));
    idx++;

    const double = text.charAt(idx) === "\n";
    if (double) {
      box.appendChild(document.createElement('br'));
      idx++;
    }

    updateCursor();
    box.scrollTop = box.scrollHeight;
    timer = setTimeout(typeStep, 150);
    return;
  }

  // Append character safely
  const lastNode = box.lastChild;
  if (!lastNode || lastNode === cursor || lastNode.nodeType !== Node.TEXT_NODE) {
    box.insertBefore(document.createTextNode(ch), cursor);
  } else {
    lastNode.textContent += ch;
  }

  idx++;
  updateCursor();
  box.scrollTop = box.scrollHeight;

  timer = setTimeout(typeStep, 18);
}

function startTyping() {
  clearTimeout(timer);
  idx = 0;
  box.innerHTML = "";
  box.appendChild(cursor);

  setTimeout(typeStep, 200);
}

replayBtn.addEventListener('click', () => {
  startTyping();
});

window.addEventListener('load', () => {
  startTyping();
});
</script>

</body>
</html>
